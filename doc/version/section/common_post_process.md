# 共通後処理

元嘉暦では経朔、儀鳳暦以降では定朔を求めてきたが、さらに月ごとの固有値を求める

この計算は当月と次月の経朔/定朔を必要とするため、例として11月定朔/12月定朔を使うことにする

一例として宣明暦をもとに進める

# 月の大小を求める

太陰太陽暦において1ヶ月の日数は29日または30日である

求め方は『日本暦日原典』凡例のp.6を参照した

これを求める上で、朔日の大余（1日を示す単位）を比較する

例えば、 11月の朔日（定朔）が 52-2655 で、 12月の朔日（定朔）が 22-6780 の場合、52 と 22 を取り出し、 差分が10で割り切れるかを検証する

52 - 22 = 30 は10で割り切れるため、これは11月は大の月（30日）である

もし割り切れない場合（差分が29の場合）は小の月（29日）である

なお、引用元では定朔の干支から求めているが、干支の元ネタが大余のため、実装の容易さから上記のような解説となった

# 二十四節気の所属を求める

その月が何月であるかは二十四節気の中気にあることはすでに述べた通りである

ここでは中気節気と月を対応させることにする

求め方だがこれは確たる引用元がない

『日本暦日原典』においても同著者の「宣明暦に関する研究」に遡っても言及がなかった

ただし以下のようにすれば『日本暦日原典』通りに求めることができる

11月定朔を求める時に、前年冬至として 11-2730 を求めていた

また、 `気策（24分の1年）` (15-1835.5) が定義されており、二十四節気のそれぞれの間隔が固定値であることが分かる

つまり、 `前年冬至` (11-2730) + `気策（24分の1年）` (15-1835.5) = `小寒` (26-4565.5) ≒ 26-4565

結果から秒は省略する（切り捨てる）

これを繰り返すことで二十四節気それぞれの値を得ることができる

（これは常気法の求め方であり、貞享暦以降の定気法では異なる）

もし前年冬至〜当年冬至まで処理を繰り返す場合は、単に24個分を求めるというよりは、
前年大雪（前年冬至 - 気策）、当年冬至、当年小寒まで求めておいた方が良い

こうして得られた二十四節気を11月から順に比較していく

11月を例に取ると、 11月定朔（ 52-2655 ） <= 二十四節気 < 12月定朔（22-6780） である

すでに言及した通り大余は60で一巡して0になるため、範囲計算はそれを考慮して行う必要がある

11月には前年大雪（ 56-894 ）と前年冬至（ 11-2730 ）が含まれているため、これが11月の中気/節気（取り上げた順番に従うと 節気/中気）となる

以上の手続きで『日本暦日原典』通りの結果が得られる
