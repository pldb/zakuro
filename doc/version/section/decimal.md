# 小数点以下の扱い

『日本暦日原典』に記載はされていないが、実際の計算から推定した手順を記載する

# 小数点以下の切り捨て

小数点以下桁数を2桁で四捨五入し、その後で小数点以下を切り捨てる

これは次の誤差が生じたことで判明した

## 誤差一覧
`-` が『日本暦日原典』の結果を指す

### 儀鳳暦
* 大宝 2年
```
- 5 大 丁卯 3-1129 702 5 31 (12)22-138 (11)6-1185
+ 5 大 丁卯 3-1128 702 5 31 (12)22-138 (11)6-1185
```

* 養老 3年
```
- 閏7 小 丁巳 53-767 719 8 20            (17)7-478
+ 閏7 小 丁巳 53-768 719 8 20            (17)7-478
```

### 大衍暦
* 神護景雲 2年
```
- 5 小 甲辰 40-632 768 5 21 (12)8-363 (11)52-2739
+ 5 小 甲辰 40-633 768 5 21 (12)8-363 (11)52-2739
```
* 仁寿 2年
```
- 10 大 癸亥 59-1781 852 11 15 (22)0-2538 (23)16-162
+ 10 大 癸亥 59-1782 852 11 15 (22)0-2538 (23)16-162
```

### 宣明暦
* 天暦 2年
```
- 7 小 戊申 44-8274 948 8 8 (16)53-690 (17)8-2525
+ 7 小 戊申 44-8275 948 8 8 (16)53-690 (17)8-2525
```

* 仁平 2年
```
- 354日   3 小 丙申 32-1497 1152 4 7 (8)41-2025 (9)56-3860
+ 354日   3 小 丙申 32-1496 1152 4 7 (8)41-2025 (9)56-3860
```

* 承久 2年
```
- 庚辰   2 小 壬戌 58-7037 1220 3 7 (6)7-3693 (7)22-5529
+ 庚辰   2 小 壬戌 58-7038 1220 3 7 (6)7-3693 (7)22-5529
```

* 安貞 1年
```
- 8 大 丁未 43-5913 1227 9 12 (18)46-6506 (19)1-8341
+ 8 大 丁未 43-5912 1227 9 12 (18)46-6506 (19)1-8341
```

* 永享 10年
```
- 12 大 辛亥 47-2832 1438 12 17 (2)15-1196 (1)59-7760
+ 12 大 辛亥 47-2833 1438 12 17 (2)15-1196 (1)59-7760
```

## 調査結果
月の運行を求める際に生じた、小数点以下桁数による誤差である
宣明暦で言えば、第14表を引き当てるための大余小余がずれている
まず、この大余小余は11月とそれより後の月で元となる値が異なる
* 11月の場合は [宣明暦](../senmyou.md) の `月の進退から月の運動の補正値を求める` に記載の通りである
* それより後の月の場合は 弦を4回ずつ加算することで得られる
  仮に閏月がない年とした場合、11月に弦を4回足せば12月、8回足せば1月といった求め方をする

この大余小余のうち、小余の小数点以下と、秒を小余に置き直した結果を合算し、小余に繰り上げる処理を行なっているが、この繰上げが噛み合っていない
zakuroでは次の表の合算値を切り捨てているが、『日本暦日原典』では切り上げている

### 儀鳳暦
|小余|小余（秒 / 12）|合算|
|:----|:----|:----|
|950.4999913|0.5|950.9999913|
|390.7499913|0.25|390.9999913|

### 大衍暦
|小余|小余（秒 / 80）|合算|
|:----|:----|:----|
|1697.921259|0.075|1697.996259|
|2656.833759|0.1625|2656.996259|

### 宣明暦
|小余|小余（秒 / 100）|合算|
|:----|:----|:----|
|6291.709782|0.29|6291.999782|
|361.9497818|0.05|361.9997818|
|5470.569782|0.43|5470.999782|
|4552.089782|0.91|4552.999782|
|2161.659782|0.34|2161.999782|

