# 滅日

没日を端的に説明すると、1朔望月（29.5..日）を30日で表わすために、一定の法則で `不足した日` として配置された日である

経朔（平均値で求めた月初日）をもとに計算を行う

## 計算
### 宣明暦
「長慶宣明暦算法」に従う

下記は該当箇所の引用と、それに対応する計算を示している

```
◯滅日ヲ求ルノ術
```

```
経朔之小余朔虚分ノ三千九百四十三ヨリ巳下ハ者之ヲ置キテ三十ヲ以テ之ヲ乗シ朔虚分ヲ以テ之ヲ除シ商ヲ以テ日ト為ス経朔ノ大余ヲ加フ甲子ヨリ命スル事右ノ如シ
```

* 滅日あり
  * 経朔の小余 < 3943
* 計算方法
  * (経朔の小余 * 30) / 3943 = 大余（正数） ... A
  * (経朔の小余 * 30) % 3943 = 小余        ... B
* 滅余
  * (A + 経朔の大余) % 60 = 大余
  * B = 小余

```
第一段ノ経朔ノ小余ノ數三千九百四十三ヨリ少クハ滅日ヲ求メヨト云フナリ則チ己丑ノ十二月ノ小余三百二十アリコレ朔虚分ノ數ヨリ少キ故ニ滅日ヲ求ムコノ三百二十置キテ三十ヲ以テ乗スレハ九千六百トナルコレヲ朔虚分ノ三千九百四十三ニテワレハ商ニトナリ不盡一千七百一十四アリ此ノ商ニニ経朔ノ大余二十二ヲクワエテ滅日ノ大余二十四小余一千七百十四トナルモシ経朔ノ大余ヲ加エテ甲子ノ六十にミツレハコレヲ去モシ小余ニ三十ヲ乗ソモ朔虚分ノ數ニタラサル時ハ経朔ノ大余ヲ直ニ用ユヘシ支干ヲ付ルフツ子ノ如ク紀法ノ圖ニテモトムヘシ二十四ハ戊子ナリ
```

* 経朔: 大余22小余320
* 滅日あり
  * 320 < 3943
* 計算
  * 30 * 320 = 9600
  * 9600 / 3943 = 2
  * 9600 % 3943 = 1714
* 滅余
  * (2 + 22) % 60 = 24
  * 1714

```
大余ニ二　小余ニ三千五百九十一
```

* 大余2小余3591

```
滅日ノ大小余ニ此ノ如ク加フレハ其次ノ滅日ノ大小余トナルモシクワエテ大余甲子ノ六十ニナレハ減去ス又小余朔虚分ノ三千九百四十三ニナレハ減去シテ大余三ヲ加フヘシサテ滅日ノアル月ハ経朔ノ小余朔虚分ノ數ヨリ以下ノ處ナリ
```

* 次の滅余
  * (小余1714 + 小余3591) % 3943 = 1362
  * (大余24 + 大余2 + 繰り上げ1) % 60 = 27

## 大衍暦
『歴代天文律暦等志彙編　七』に従う

### 本文

```
推滅日　以有滅之朔経小餘, 減大衍通法。餘, 倍参伍乗之, 用減滅法。餘, 満朔虚分, 為日。不満, 為滅餘。命起経朔初日算外, 即合朔後滅日也。凡経朔小餘不満朔虚分者, 為有滅之朔。
```
p.2056

```
大衍通法:三千四十。
四象之策:二十九:餘, 一千六百一十三。
```
p.2055-2056

### 定数
計算方法は宣明暦と変わらない。定数のみ取りだす

#### 朔虚分

本文中に言及はないが、宣明暦と変わらないと見て良い

`理想の月日数` (30) * `大衍通法` (3040) - ( `四象之策` (29 * 3040 + 1613) ) = 1427

#### 小余倍率

`倍参伍` (2 * 3 * 5) = 30

# 備考

## 前月経朔の引き当て
『日本暦日便覧』により、前月からの経朔で計算するパターンがある

| 天平神護3年3月1日 | 寛平3年5月1日  | 長寛2年11月1日   | 貞治4年閏9月1日 | 永正2年10月1日  | 寛文7年1月1日  |
| 宝亀6年2月1日     | 天延3年12月1日 | 仁安3年11月1日   | 応安6年9月1日   | 永正10年9月1日  | 延宝2年12月1日 |
| 承和2年12月1日    | 永観1年11月1日 | 安元2年10月1日   | 永徳1年8月1日   | 天文11年10月1日 | 天和2年11月1日 |
| 承和10年11月1日   | 正暦2年10月1日 | 元久1年7月1日    | 康応1年7月1日   | 天文19年9月1日  |                |
| 仁寿1年10月1日    | 長保1年9月1日  | 建暦2年6月1日    | 応永4年6月1日   | 永禄1年8月1日   |                |
| 貞観1年9月1日     | 寛弘4年8月1日  | 延慶1年11月1日   | 応永12年5月1日  | 永禄9年8月1日   |                |
| 貞観9年8月1日     | 長和4年7月1日  | 正和1年11月1日   | 応永20年4月1日  | 天正2年7月1日   |                |
| 貞観17年7月1日    | 康平3年7月1日  | 正和5年閏10月1日 | 延徳1年12月1日  | 天正10年6月1日  |                |
| 元慶7年6月1日     | 治暦4年6月1日  | 元応2年10月1日   | 明応6年11月1日  | 天正18年5月1日  |                |

もし当月の経朔で計算できない場合は、前月からの経朔で計算している

## 『日本暦日原典』との照合
『日本暦日便覧』は初版を参考にしているものと思われるが、当ライブラリは第四版に準拠するため、次のような相違が見られる

| 西暦日     | 和暦日（初版）   | 和暦日（第四版） | 備考                                            |
| ---------- | ---------------- | ---------------- | ----------------------------------------------- |
| 0807-11-27 | 大同2年10月24日  | 大同2年10月23日  | 第四版のみ注釈あり                              |
| 0823-12-03 | 弘仁14年10月27日 | 弘仁14年10月26日 | 初版のみ注釈あり                                |
| 0794-06-21 | 延暦13年5月19日  | 延暦13年5月18日  | 初版/第四版の注釈相違。第四版では運用値に寄せる |
